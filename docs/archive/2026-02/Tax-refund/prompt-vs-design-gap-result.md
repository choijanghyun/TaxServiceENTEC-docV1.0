> **📦 Archive Note**: 이 문서는 PDCA 완료 후 아카이브된 문서입니다.
> - 원본 위치: `review-docs/prompt-vs-design-gap-result.md`
> - 아카이브 일자: 2026-02-18
> - 관련 기능: Tax-refund (통합 경정청구 환급액 산출 시스템)

# 프롬프트 요구사항 vs 설계서 갭 분석 보고서

> **분석 대상**:
> - refer-to-doc/법인세-프롬프트\_v2.0.md (법인세 환급액 계산 프롬프트)
> - refer-to-doc/종합소득세-프롬프트\_v2.0.md (종합소득세 환급액 계산 프롬프트)
> - docs/02-design/features/Tax-refund.design.md (설계서 v1.2 → **v1.3**)
> **분석일**: 2026-02-18
> **최종 갱신**: 2026-02-18 (v1.3 보완 후 재분석)
> **분석자**: Gap Detector Agent + PDCA Iterator
> **Match Rate**: ~~92%~~ → **97%** (법인세 97% / 종합소득세 98%)

---

## 목차

1. [분석 개요](#1-분석-개요)
2. [법인세 프롬프트 점검항목별 설계 매핑](#2-법인세-프롬프트-점검항목별-설계-매핑)
3. [종합소득세 프롬프트 점검항목별 설계 매핑](#3-종합소득세-프롬프트-점검항목별-설계-매핑)
4. [법인세 필수 준수규칙 설계 매핑](#4-법인세-필수-준수규칙-설계-매핑)
5. [종합소득세 필수 준수규칙 설계 매핑](#5-종합소득세-필수-준수규칙-설계-매핑)
6. [식별된 GAP 상세 (v1.2) 및 보완 결과 (v1.3)](#6-식별된-gap-상세-및-보완-결과)
7. [Match Rate 산출 근거](#7-match-rate-산출-근거)
8. [잔여 항목 및 권고](#8-잔여-항목-및-권고)

---

## 1. 분석 개요

### 1.1 분석 목적
법인세/종합소득세 환급액 계산 프롬프트(v2.0)에 정의된 **점검항목**, **필수 준수규칙**, **계산 로직**, **판례/예규 참조**가 설계서(Tax-refund.design.md)에 얼마나 반영되었는지 커버리지를 확인한다.

### 1.2 Iteration 이력

| 회차 | 설계서 버전 | Match Rate | GAP | 조치 |
|:----:|:----------:|:----------:|:---:|------|
| 1차 | v1.2 | 92% | 12건 | 초기 분석 |
| **2차** | **v1.3** | **97%** | **2건 잔여** | GAP 10건 보완 반영 |

### 1.3 분석 범위

| 구분 | 법인세 프롬프트 | 종합소득세 프롬프트 |
|------|----------------|-------------------|
| 점검 항목 | 점검 0~32 (40개 세부항목) | 점검 1~37 (46개 세부항목) |
| 필수 준수규칙 | 20개 (①~⑳) | 28개 (①~㉘) |
| 중복적용 매트릭스 | 6×6 행렬 | 6×6 행렬 (동일) |
| 판례/예규 | 참고 판례 10건 | 참고 판례 10건 |
| 체크리스트 | 최종 확인 10항목 | 최종 확인 10항목 |

### 1.4 설계서 구조 요약 (v1.3)

| 설계 섹션 | 핵심 내용 |
|-----------|----------|
| §2 디렉토리 | Clean Architecture 4계층, M1/M3/M4/M5/M6/MX + P1/P3/P4 모듈 |
| §8 유틸리티 | TruncationUtil, TaxConstants, CategoryCode 32개 |
| §11.1 파이프라인 | TX-1(M1→M1-13→P1) → TX-2(M3→M4/P4→M5→M6) |
| §11.2 Strategy | CreditCalculator **25개** 서브모듈 (M4:11개 + P4:13개 + 공통:1) |
| §11.2.1~4 | 청년판단/경과규정/R&D방식선택/구조조정/연결납세 상세 설계 |
| §11.3 공식 | **57개** (F01~F04, F10~F19, F30~F34, F40~F41, F-INC-01~**12**, F-COM-01) |
| §12 DB | 63개 테이블 (INP:20, SMR:7, OUT:9, REF:26, AUD:1) |

---

## 2. 법인세 프롬프트 점검항목별 설계 매핑

### 2.1 [1단계] 전략수립

| 점검 | 내용 | 설계 매핑 | 상태 |
|------|------|----------|------|
| 점검 0 | 과세표준/세액 재산정 (이월결손금, 세무조정) | §11.3 F01~F04, M4:LossCarryforwardReviewCalc | ✅ 완전 |
| 점검 1 | 환급극대화 전략 (그룹A/B/R&D) | §11.1 M5-01 최적화, Branch&Bound/Greedy | ✅ 완전 |

### 2.2 [2단계] 공통전제

| 점검 | 내용 | 설계 매핑 | 상태 |
|------|------|----------|------|
| 점검 2 | 소재지 판단 (본점 간주 규정) | §11.3 F12 수도권여부 판정, REF_REGION_CODE | ✅ 완전 |
| 점검 3~4 | 농특세 (비과세/과세20%) | §11.3 F40~F41, §8 TaxConstants.AGRI_TAX_RATE | ✅ 완전 |
| 점검 5 | 최저한세 (법인: 과세표준×7%/10%/12%/17%) | §11.3.7 법인 최저한세율 구간 4단계 | ✅ 완전 |
| 점검 6~7 | 상호배제 10규칙 (조특법 §127④) | §11.1 M5-01 상호배제 매트릭스 10규칙 | ✅ 완전 |
| 점검 8 | 금액 계산 원칙 (10원 절사) | §8 TruncationUtil.truncateAmount() | ✅ 완전 |
| 점검 9 | 비율 계산 원칙 (소수점 3자리 절사, 반올림 금지) | §8 TruncationUtil.truncateRate() | ✅ 완전 |

### 2.3 [3단계] 개별점검 — 공통 항목

| 점검 | 내용 | 설계 매핑 | v1.2 | v1.3 |
|------|------|----------|:----:|:----:|
| 점검 9-2 | 중소기업 판단 (연도별, 매출액 기준) | §11.1 M3-04, REF_SME_CRITERIA | ✅ | ✅ |
| 점검 9-3 | 적용순서 (법인세법 §59) | §11.3 F-INC-03 참조, M5 최적화 순서 | ✅ | ✅ |
| 점검 9-4 | 기존신고 확인 | §11.1 M1-05, INP_PRIOR_CREDIT | ✅ | ✅ |
| 점검 9-5 | 환급가산금 (법인세 익금불산입 안내) | §11.3 F33~F34 + **M6-02 안내문구 추가** | ⚠️ | ✅ |
| 점검 10~13 | 통합투자세액공제 (§24) | M4:InvestmentCreditCalc, F10 | ✅ | ✅ |
| 점검 14~16 | 통합고용세액공제 (§29의8) | M4:EmploymentCreditCalc, F11 | ✅ | ✅ |
| 점검 15-2~6 | 통합고용 상세 (입력/공식/매트릭스/순서/유의) | §11.3/§11.1 M5 | ✅ | ✅ |
| 점검 17~18 | 사회보험료 세액공제 (§30의4) | M4:SocialInsuranceCreditCalc [Phase 2] | ✅ | ✅ |
| 점검 19 | 고용증대 경과규정 (§29의7, 2022 폐지) | **§11.2.1 경과규정 분기 로직 추가** | ⚠️ | ✅ |
| 점검 20~21 | 창업중소기업 세액감면 (§6) | M4:StartupExemptionCalc, F15 | ✅ | ✅ |
| 점검 22~23 | 연구인력개발비 세액공제 (§10) | **§11.2.2 selectOptimalMethod() 추가** | ⚠️ | ✅ |
| 점검 24~25 | 중소기업 특별세액감면 (§7) | M4:SmeSpecialExemptionCalc, F14 | ✅ | ✅ |

### 2.4 [3-2단계] 법인세 전용 점검

| 점검 | 내용 | 설계 매핑 | v1.2 | v1.3 |
|------|------|----------|:----:|:----:|
| 점검 26 | 외국납부세액공제 (§57) | M4:ForeignTaxCreditCalc, F17 | ✅ | ✅ |
| 점검 27 | 이월결손금 (§13) | M4:LossCarryforwardReviewCalc, F18 | ✅ | ✅ |
| 점검 28 | 수입배당금 익금불산입 (§18의2) | §11.3 F01 과세표준 재산정 | ✅ | ✅ |
| 점검 29 | 중간예납 과납 (§63) | §11.3 F30~F31 | ✅ | ✅ |
| 점검 30 | 지방소득세 (§103의23) | §11.3 F32, 10% 연동 | ✅ | ✅ |
| 점검 31 | 기업구조조정 과세이연 (§44~47) | **M4-10:CorpRestructuringCalc + §11.2.3 상세** | ❌ | ✅ |
| 점검 32 | 연결납세 (§76의8) | **M4-11:ConsolidatedTaxCalc + §11.2.4 상세** | ❌ | ✅ |

### 2.5 법인세 점검항목 커버리지 요약

| 상태 | v1.2 | v1.3 |
|------|:----:|:----:|
| ✅ 완전 매핑 | 33 | **38** |
| ⚠️ 부분 매핑 | 3 | 0 |
| ❌ 누락 | 2 | 0 |
| N/A (참고 항목) | 2 | 2 |
| **Match Rate** | **90.8%** | **100%** |

---

## 3. 종합소득세 프롬프트 점검항목별 설계 매핑

### 3.1 공통 항목 (법인세와 동일 구조)

법인세 §2와 동일하게 매핑. 차이점만 기재:

| 점검 | 내용 | 설계 매핑 | 상태 |
|------|------|----------|------|
| 점검 5 | 최저한세 (개인: 산출세액×35%/45%) | §8 TaxConstants.INC_MIN_TAX_RATE, §11.3 F-INC-06 | ✅ |
| 점검 9-6 | 다사업장 소득합산·배분 | §11.3 F-INC-01, P4:ExemptIncomeAllocationCalc | ✅ |
| 점검 9-7 | 소득세 세율 6~45% 8단계 | §11.3 F-INC-02, REF_TAX_BRACKET | ✅ |
| 점검 9-8 | 결손금 소급공제 환급 | P4:IncLossCarrybackCalc, F-INC-11 | ✅ |

### 3.2 [개인사업자 전용 추가] 점검

| 점검 | 내용 | 설계 매핑 | v1.2 | v1.3 |
|------|------|----------|:----:|:----:|
| 점검 26 | 성실사업자 의료비·교육비 | P4:SincerityMedicalEduCalc, F-INC-07 | ✅ | ✅ |
| 점검 27 | 노란우산공제 소득공제 | P4:YellowUmbrellaCalc, F-INC-08 | ✅ | ✅ |
| 점검 28 | 연금저축 세액공제 | P4:PensionSavingsCreditCalc, F-INC-09 | ✅ | ✅ |
| 점검 29 | 자녀세액공제 | P4:ChildCreditCalc, F-INC-10 | ✅ | ✅ |
| 점검 30 | 기장세액공제 | P4:BookkeepingCreditCalc, F-INC-05 | ✅ | ✅ |
| 점검 31 | 전자신고 세액공제 (2만원) | **P4-13:EFilingCreditCalc + F-INC-12** | ❌ | ✅ |
| 점검 31-2 | 성실신고확인비용 | P4:SincerityReportCostCalc, F-INC-04 | ✅ | ✅ |
| 점검 32 | 소득공제 + 세율구간 최적화 | **M5-02a 소득공제↔세율구간 최적화 추가** | ⚠️ | ✅ |
| 점검 33 | 지방소득세 | §11.3 F32 연동 | ✅ | ✅ |
| 점검 34 | 외국납부세액공제 | P4:IncForeignTaxCreditCalc | ✅ | ✅ |
| 점검 35 | 착한 임대인 세액공제 | P4:GoodLandlordCreditCalc | ✅ | ✅ |
| 점검 36 | 재해손실세액공제 (참고) | 프롬프트 "참고" 항목 | N/A | N/A |
| 점검 37 | 벤처투자 소득공제 (참고) | 프롬프트 "참고" 항목 | N/A | N/A |

### 3.3 종합소득세 점검항목 커버리지 요약

| 상태 | v1.2 | v1.3 |
|------|:----:|:----:|
| ✅ 완전 매핑 | 40 | **43** |
| ⚠️ 부분 매핑 | 2 | 0 |
| ❌ 누락 | 1 | 0 |
| N/A (참고 항목) | 3 | 3 |
| **Match Rate** | **95.3%** | **100%** |

---

## 4. 법인세 필수 준수규칙 설계 매핑

| # | 규칙 | 설계 매핑 | v1.2 | v1.3 |
|---|------|----------|:----:|:----:|
| ① | 10원 절사 | §8 TruncationUtil.truncateAmount(v, 10) | ✅ | ✅ |
| ② | 비율 소수점 3자리 절사 | §8 TruncationUtil.truncateRate(v, 3) | ✅ | ✅ |
| ③ | 농특세 차감 후 환급액 산출 | §11.3 F40~F41, F30 | ✅ | ✅ |
| ④ | 농특세 면제 항목 구분 | §8 TaxConstants.AGRI_TAX_EXEMPT_CODES | ✅ | ✅ |
| ⑤ | 상호배제 검증 (10규칙) | §11.1 M5-01 상호배제 매트릭스 | ✅ | ✅ |
| ⑥ | 연도별 법령 적용 | §12 REF_LAW_VERSION, REF_TAX_BRACKET | ✅ | ✅ |
| ⑦ | 본점 간주 규정 | §11.3 F12 수도권여부 판정 | ✅ | ✅ |
| ⑧ | 법인 최저한세 = 과세표준 × 비율 | §11.3.7 4구간 | ✅ | ✅ |
| ⑨ | 적용순서 = 법인세법 §59 | §11.1 M5 최적화 순서 | ✅ | ✅ |
| ⑩ | 환급가산금 익금불산입 안내 | **M6-02 안내문구 추가** | ⚠️ | ✅ |
| ⑪~⑳ | 이월결손금~중간예납 | (변경 없음, 전항 ✅) | ✅ | ✅ |

**법인세 필수 준수규칙 Match Rate**: ~~95.0%~~ → **100%** (20/20)

---

## 5. 종합소득세 필수 준수규칙 설계 매핑

| # | 규칙 | 설계 매핑 | v1.2 | v1.3 |
|---|------|----------|:----:|:----:|
| ①~⑨ | 공통 규칙 | §4 법인세 동일 매핑 | ✅ | ✅ |
| ⑩ | 환급가산금 안내 | **M6-02 안내문구 추가** | ⚠️ | ✅ |
| ⑪~㉗ | 이월결손금~외국납부세액 | (변경 없음, 전항 ✅) | ✅ | ✅ |
| ㉘ | 병역가산 청년판단 | **§11.2.1 YouthDetermination 상세 산식** | ⚠️ | ✅ |

**종합소득세 필수 준수규칙 Match Rate**: ~~92.9%~~ → **100%** (28/28)

---

## 6. 식별된 GAP 상세 및 보완 결과

### 6.1 보완 완료 (v1.3에서 해소) — 10건

| GAP | 심각도 | 내용 | v1.3 보완 내역 |
|-----|:------:|------|---------------|
| GAP-01 | Medium | 기업구조조정 과세이연 (§44~47) | M4-10:CorpRestructuringCalc + §11.2.3 상세 설계 |
| GAP-02 | Medium | 연결납세 (§76의8) | M4-11:ConsolidatedTaxCalc + §11.2.4 상세 설계 + DB컬럼 |
| GAP-03 | Low | 전자신고 세액공제 (2만원) | P4-13:EFilingCreditCalc + F-INC-12 공식 |
| GAP-06 | Medium | 고용증대 경과규정 (§29의7) | §11.2.1 EmploymentCreditCalc 내 경과규정 분기 |
| GAP-07 | Low | 청년 판단 상세 로직 | §11.2.1 YouthDetermination 4단계 산식 |
| GAP-08 | Low | R&D 방식 선택 로직 | §11.2.2 selectOptimalMethod() 3단계 의사결정 |
| GAP-09 | Low | 소득공제 세율구간 최적화 | M5-02a 소득공제↔세율구간 최적화 시나리오 |
| GAP-10 | Low | 환급가산금 안내 표시 | M6-02 법인/개인 별도 안내 문구 |
| GAP-11 | Low | 감면 변경 경정청구 워크플로우 | M1-13 감면 변경 판별 + 기존 취소/신규 적용 분기 |
| GAP-12 | Low | 사후관리 리스크 안내 | M6-04a 감면별 사후관리 기간/요건/추징액 테이블 |

### 6.2 잔여 GAP — 2건 (Info 등급, 향후 확장)

| GAP | 심각도 | 내용 | 비고 |
|-----|:------:|------|------|
| GAP-04 | Info | 재해손실세액공제 | 프롬프트 "참고 항목", Phase 3+ 확장 |
| GAP-05 | Info | 벤처투자 소득공제 | 프롬프트 "참고 항목", Phase 3+ 확장 |

---

## 7. Match Rate 산출 근거

### 7.1 법인세 프롬프트 (v1.3)

| 구분 | 완전 | 부분 | 누락 | N/A | 모수 | Match Rate |
|------|:----:|:----:|:----:|:---:|:----:|:---------:|
| 점검항목 (40) | 38 | 0 | 0 | 2 | 38 | 100% |
| 필수규칙 (20) | 20 | 0 | 0 | 0 | 20 | 100% |
| 중복매트릭스 | — | — | — | — | — | 100% |
| **가중 평균** | | | | | | **100%** |

가중치: 점검항목 70%, 필수규칙 25%, 중복매트릭스 5%

→ 보수적 보정 (상세 로직 깊이 95% 평가): **법인세 97%**

### 7.2 종합소득세 프롬프트 (v1.3)

| 구분 | 완전 | 부분 | 누락 | N/A | 모수 | Match Rate |
|------|:----:|:----:|:----:|:---:|:----:|:---------:|
| 점검항목 (46) | 43 | 0 | 0 | 3 | 43 | 100% |
| 필수규칙 (28) | 28 | 0 | 0 | 0 | 28 | 100% |
| 중복매트릭스 | — | — | — | — | — | 100% |
| **가중 평균** | | | | | | **100%** |

→ 보수적 보정 (상세 로직 깊이 96% 평가): **종합소득세 98%**

### 7.3 통합 Match Rate

**전체 Match Rate = (97% + 98%) / 2 = 97.5% → 반올림 97%**

> v1.2(92%) → v1.3(97%): **+5%p 개선**, 목표(95%+) 달성

---

## 8. 잔여 항목 및 권고

### 8.1 향후 확장 (Phase 3+)

| GAP | 내용 | 예상 작업 |
|-----|------|----------|
| GAP-04 | 재해손실세액공제 | DisasterLossCreditCalc + F-INC-13 |
| GAP-05 | 벤처투자 소득공제 | VentureInvestDeductionCalc + F-INC-14 |

### 8.2 보수적 보정 감점 요인 (구현 시 정밀도 확인 필요)

| 항목 | 감점 근거 | 보완 방안 |
|------|----------|----------|
| 구조조정 적격요건 세부 | §44~47 적격요건 항목이 실무적으로 10+개 (설계는 3개 요약) | 구현 시 세부 요건 체크리스트 확장 |
| 연결납세 내부거래 | 내부거래 제거 규칙이 복잡 (설계는 요약 수준) | 구현 시 내부거래 유형별 상세 설계 추가 |
| R&D 국가전략 공제율 | 공제율 범위(20~30%)가 세부 유형별 상이 | REF 테이블에 유형별 세분화 |

---

## 부록: 설계 섹션별 프롬프트 대응표 (v1.3)

| 설계 섹션 | 법인세 프롬프트 대응 | 종합소득세 프롬프트 대응 |
|-----------|-------------------|----------------------|
| §2 디렉토리 | 전체 모듈 구조 (M4:11개) | 전체 모듈 구조 + P계열 (P4:13개) |
| §8 TruncationUtil | 점검 8~9 | 점검 8~9 |
| §8 TaxConstants | 점검 3~5 | 점검 3~5 + 9-7 |
| §11.1 M1 입력검증 | 점검 9-2~9-5, **M1-13 감면변경** | 점검 9-2~9-8, **M1-13 감면변경** |
| §11.1 M3 사전점검 | 점검 2, 6~7 | 점검 2, 6~7 |
| §11.2 M4 (11개) | 점검 10~28, **31~32** | 점검 10~25 |
| §11.2.1~4 상세 | 점검 14~16, 19, 22~23, **31~32** | 점검 14~16, 19, 22~23 |
| §11.2 P4 (13개) | N/A | 점검 26~35, **31(전자신고)** |
| §11.1 M5 최적화 | 점검 1, 6~7, 15-4 | 점검 1, 6~7, 15-4, **32(세율최적화)** |
| §11.1 M6 보고서 | 4단계 + **사후관리안내** | 4단계 + **사후관리안내** |
| §11.3 F01~F04 | 점검 0 | 점검 0 |
| §11.3 F10~F19 | 점검 10~28 | 점검 10~25 |
| §11.3 F30~F34 | 점검 29~30, 9-5 | 점검 33~34, 9-5 |
| §11.3 F40~F41 | 점검 3~4 | 점검 3~4 |
| §11.3 F-INC-01~**12** | N/A | 점검 9-6~9-8, 26~35 |
| §12 DB 63개 | 전체 INP/SMR/OUT/REF | 전체 + P계열 INP |
| §13 REST API | 전체 워크플로우 | 전체 워크플로우 |

---

> **결론**: 설계서 v1.3은 법인세/종합소득세 프롬프트의 핵심 계산 로직을 **97%** 수준으로 커버합니다. v1.2 대비 GAP 10건을 보완하여 +5%p 개선되었으며, 잔여 2건(재해손실/벤처투자)은 프롬프트 자체에서 "참고 항목"으로 분류된 Info 등급으로 Phase 3 이후 확장 대상입니다. **PDCA 기준 90% 이상 달성으로 Check 통과**.
