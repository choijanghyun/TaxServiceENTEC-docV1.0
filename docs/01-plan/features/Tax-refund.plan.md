# Tax-refund 계획서 — 통합 경정청구 환급액 산출 시스템

> **Summary**: 법인(법인세)과 개인사업자(종합소득세) 경정청구 환급액 극대화를 위한 AI 기반 통합 점검 시스템 구축 계획
>
> **Project**: TaxServiceENTEC (통합 경정청구 환급액 산출 시스템)
> **Version**: v1.1
> **Author**: Plan (PDCA)
> **Date**: 2026-02-18
> **Status**: Draft

---

## 목차

1. [개요](#1-개요)
2. [범위](#2-범위)
3. [요구사항 요약](#3-요구사항-요약)
4. [아키텍처 방향](#4-아키텍처-방향)
5. [구현 로드맵](#5-구현-로드맵)
6. [성공 기준](#6-성공-기준)
7. [리스크 및 대응](#7-리스크-및-대응)
8. [컨벤션 및 파이프라인](#8-컨벤션-및-파이프라인)
9. [다음 단계](#9-다음-단계)

---

## 1. 개요

### 1.1 목적

세무사/세무법인이 법인사업자(법인세, CORP) 및 개인사업자(종합소득세, INC)의 경정청구 시 **환급액을 극대화**하는 통합 점검 시스템을 구축한다.

- 법인 40개 + 개인 37개 = **총 77개 점검항목** 자동화
- 4단계 점검 절차: 사전확인 → 전제조건 → 공제/감면 산출 → 최종보고
- 상호배제 10규칙 기반 **최적 조합 탐색** (Branch & Bound / Greedy)
- 건당 진단 시간: 3시간 → **30분 이내** 단축 목표

### 1.2 배경

| 항목 | 현황 |
|------|------|
| 시장 규모 | 삼쩜삼 누적 환급 1.7조원, 비즈넵 평균 환급 960만원, 국세청 원클릭 2025.3 출시 |
| Pain Point | 77개 항목 수작업 2~3시간, 상호배제 조합 판단 불가, 세법 개정 즉시 반영 어려움 |
| 차별화 | B2B 세무사 전문 도구, 법인+개인 통합, 최적 조합 자동 탐색, 연도별 법령 분기 |

### 1.3 관련 문서

| 문서 | 경로 | 역할 |
|------|------|------|
| 요구사항 정의서 | `docs/requirements-tax-refund-system.md` | 페르소나 5개, 에픽 10개, 스토리 27개 |
| 개발설계서 v2.1 (초안) | `참고1번-development-design-v2.md` | 83개 테이블, 107개 검증규칙, 56개 공식 |
| 법인세 프롬프트 v2.0 | `법인세-프롬프트_v2.0.md` | 법인 40개 점검항목 |
| 종합소득세 프롬프트 v2.0 | `종합소득세-프롬프트_v2.0.md` | 개인 37개 점검항목 |
| 업계 리서치 | `참고2번-industry-research-tax-refund-programs.md` | 8개 서비스 비교 분석 |
| 세법기준 입력자료 | `docs/경정청구-입력자료-세법기준-정리.md` | 공제/감면별 입력자료 세법 근거 |

---

## 2. 범위

### 2.1 In Scope (구현 범위)

#### Phase 1 — MVP (Must Have, 21개 스토리)

- [x] 경정청구 요청 생성 및 req_id 발급 (Idempotency-Key)
- [x] 법인/개인 세무자료 입력 (공통 8 + CORP 16 + INC 8 = 32개 카테고리)
- [x] 입력 데이터 107개 규칙 검증 (V/C/B/L/X/W 6유형 + INC 전용 6유형)
- [x] 사전점검 — 불가사유 차단, 중소기업 판정, 소재지 분기, 상시근로자 산정
- [x] **6대 핵심 공제/감면 자동 산출**:
  - 통합투자세액공제 (§24) — 기본+추가, 2025년 추가공제율 10% 상향
  - 통합고용세액공제 (§29의8) — 환급 건수 1위, 이월 10년
  - 창업중소기업 세액감면 (§6) — 2025년 비수도권 비청년 75% 상향
  - 중소기업 특별세액감면 (§7) — 한도 1억, 이월 불가
  - R&D 세액공제 (§10) — 최저한세 배제 3단계, 이월 10년
  - *(사회보험료 §30의4는 Phase 2로 이동 — 2024년 일몰)*
- [x] 상호배제 10규칙 자동 적용 및 최적 조합 탐색
- [x] 최저한세 자동 적용 (법인: 과세표준 기준 / 개인: 산출세액 기준)
- [x] 환급액 비교 보고서 8섹션 자동 생성
- [x] **환급가산금 기본 계산** (F31~F32, F-INC-09: 본세/중간예납 기산일 분리)
- [x] **지방소득세 환급액 안내** (F33: 본세×10%, 보고서 섹션 포함)
- [x] RBAC 인증/권한 (ADMIN/MANAGER/ACCOUNTANT/VIEWER)
- [x] 기준정보 관리 (RF_* 26개 테이블 연도별 버전)

#### Phase 2 — 고도화 (Should Have)

- [ ] 사회보험료 세액공제 (§30의4, 일몰 대응)
- [ ] 법인 전용 심화: 이월결손금 재검토, 수입배당금, 외국납부세액, 감가상각 시부인
- [ ] 개인 전용 심화: 소득공제 최적화, 노란우산, 연금저축, 착한임대인, 공동사업 배분
- [ ] 고용증대 세액공제 경과규정 (2022년 §29의7 적용자의 2023~2024 경과규정 처리)
- [ ] 경정청구서 초안 자동 생성 (국세기본법 시행규칙 별지 제16호의2)
- [ ] 대시보드/현황 관리, 사후관리 알림
- [ ] **개인 전용 추가 공제/감면**:
  - 성실사업자 의료비/교육비 세액공제 (§122의3, 최저한세 비대상)
  - 성실신고확인비용 세액공제 (§126의6, 60%, 120만 한도, 최저한세 대상)
  - 기장세액공제 (소득세법 §56의2, 조특법 중복배제 비대상)
  - 자녀세액공제 (소득세법 §59의2, 7세이상 15만원/인)
  - 전자신고 세액공제 (§104의8, 2만원)
  - 착한 임대인 세액공제 (인하분×70%, 2024년 일몰)
  - 외국납부세액공제 (개인, 세액공제 vs 필요경비 비교)
  - 노란우산공제 (소득구간별 200/300/500만)
  - 연금저축 세액공제 (600만 한도, 15%/12%)
  - 결손금 소급공제 (소득세법 §85의2, NPV 비교)
- [ ] 토지양도세(§55의2), 기업구조조정(§44~47), 연결납세(§76의8)
- [ ] 시뮬레이션: 다수 과세연도, 사후관리 리스크 평가 (M7 모듈)

#### Phase 3 — 확장 (Could Have)

- [ ] 홈택스 연동 자동수집 (RPA/API, 6개년)
- [ ] B2C 개인사업자 셀프 서비스
- [ ] 재해손실세액공제, 벤처투자조합 출자 소득공제

### 2.2 Out of Scope (제외)

| 항목 | 제외 사유 |
|------|-----------|
| 홈택스 직접 제출 연동 | 국세청 API 개방 여부 불확실, 규제 리스크 |
| 지방소득세 자동 계산/제출 | 지자체별 시스템 연동 복잡, 안내만 제공 |
| 부가가치세 경정청구 | 별도 세목, 이번 범위 초과 |
| AI 챗봇 상담 인터페이스 | B2B 전문가 대상, 필요성 낮음 |
| 해외 세금 환급 | 국내 세법 전용 시스템 |

---

## 3. 요구사항 요약

### 3.1 기능 요구사항 (Phase 1 MVP)

| ID | 요구사항 | 에픽 | 우선도 | SP |
|----|----------|------|:------:|:--:|
| FR-01 | req_id 발급 + 요청 접수 (Idempotency-Key) | EP-01 | Must | 5 |
| FR-02 | 법인 세무자료 입력 (32개 카테고리, INSERT ONLY) | EP-01 | Must | 8 |
| FR-03 | 개인사업자 세무자료 입력 (다사업장/공동사업자) | EP-01 | Must | 8 |
| FR-04 | 입력 데이터 107개 규칙 검증 | EP-01 | Must | 13 |
| FR-05 | 경정청구 불가사유 Hard Fail 차단 | EP-02 | Must | 8 |
| FR-06 | 중소기업 해당 여부 자동 판정 (매출/독립성/졸업유예) | EP-02 | Must | 5 |
| FR-07 | 소재지 구분 (CORP 본점간주 / INC 사업장별) | EP-02 | Must | 8 |
| FR-08 | 상시근로자 수 산정 (제외대상, 청년 판단 시점 분기) | EP-02 | Must | 8 |
| FR-09 | 통합투자세액공제 §24 자동 계산 | EP-03 | Must | 8 |
| FR-10 | 통합고용세액공제 §29의8 자동 계산 | EP-03 | Must | 13 |
| FR-11 | 창업중소기업 세액감면 §6 자동 계산 | EP-03 | Must | 8 |
| FR-12 | 중소기업 특별세액감면 §7 자동 계산 | EP-03 | Must | 5 |
| FR-13 | R&D 세액공제 §10 자동 계산 | EP-03 | Must | 8 |
| FR-14 | 상호배제 10규칙 자동 적용 | EP-04 | Must | 8 |
| FR-15 | 최적 조합 탐색 (B&B / Greedy) | EP-04 | Must | 13 |
| FR-16 | 최저한세 자동 적용 (법인/개인 분기) | EP-04 | Must | 8 |
| FR-17 | 환급액 비교 보고서 8섹션 생성 | EP-05 | Must | 8 |
| FR-18 | RBAC 인증/권한 (JWT, 4단계 역할) | EP-08 | Must | 8 |
| FR-19 | 세율/공제율 기준정보 연도별 관리 | EP-06 | Must | 8 |

| FR-20 | 환급가산금 기본 계산 (본세/중간예납 기산일 분리) | EP-05 | Must | 5 |
| FR-21 | 지방소득세 환급액 안내 (본세×10%) | EP-05 | Must | 3 |

**Phase 1 MVP 합계**: 21개 기능, **총 177 SP**

### 3.2 비기능 요구사항

| 카테고리 | 기준 | 측정 방법 |
|---------|------|-----------|
| **성능** | 77개 항목 전체 산출 30초 이내 | JMeter 부하 테스트 |
| **정확성** | 금액 10원 미만 TRUNCATE, 비율 3자리 절사, 반올림 절대 금지 | 56개 공식 단위 테스트 100% |
| **보안** | JWT 8시간, RBAC 4단계, AES-256 개인정보 암호화 | Spring Security + SAST |
| **가용성** | 99.5% 이상, TX-1/TX-2 ACID 보장 | 모니터링 + 알림 |
| **확장성** | Strategy 패턴 공제항목 추가, TAX_TYPE enum 세목 추가 | 아키텍처 리뷰 |
| **유지보수** | 테스트 커버리지 80%+, API 문서 OpenAPI 3.0 | SonarQube + Swagger |

---

## 4. 아키텍처 방향

### 4.1 프로젝트 레벨 선정

| Level | 특징 | 적합 대상 | 선정 |
|-------|------|----------|:----:|
| Starter | 단순 구조 | 정적 사이트 | ☐ |
| Dynamic | Feature 기반 모듈 | 웹앱, SaaS MVP | ☐ |
| **Enterprise** | 엄격한 계층 분리, DI | 복잡 비즈니스, 고정밀 | ☑ |

**선정 근거**: 77개 점검항목, 107개 검증규칙, 56개 공식, 83개 테이블의 복잡한 세무 도메인은 Enterprise 수준의 계층 분리와 테스트 전략이 필수.

### 4.2 핵심 아키텍처 결정

| 결정 항목 | 선택 | 근거 |
|----------|------|------|
| Framework | Spring Boot 3.x | 엔터프라이즈 DI, 트랜잭션 관리, 세무 도메인 적합 |
| Language | Java 17 | LTS, Record/Sealed 클래스, 정밀 계산(BigDecimal) |
| Database | PostgreSQL 15 | JSON 컬럼, 부분 유니크 인덱스, RF_* 기준정보 |
| ORM | JPA + MyBatis 병행 | 엔티티 관리(JPA) + 복잡 집계 쿼리(MyBatis) |
| API | REST (JSON) | 단순성, 국세청 표준 준수 |
| 인증 | Spring Security + JWT | req_id 토큰화, RBAC 4단계 |
| 테스트 | JUnit 5 + AssertJ | 56개 공식 단위 테스트 필수 |
| 계산 전략 | Strategy Pattern | 22개 CreditCalculator 플러그인 확장 |
| 최적화 | Branch & Bound + Greedy 폴백 | 15개 이하 B&B, 초과 시 Greedy |

### 4.3 Clean Architecture 4계층

```
┌─────────────────────────────────────────────────────────────────┐
│ Presentation Layer                                              │
│   - REST Controller (11개 엔드포인트 API-01~11)                  │
│   - DTO (Request/Response), GlobalExceptionHandler              │
├─────────────────────────────────────────────────────────────────┤
│ Application Layer                                               │
│   - AmendmentClaimService (유스케이스 오케스트레이터)             │
│   - TX-1 (입력 트랜잭션), TX-2 (계산 트랜잭션)                   │
├─────────────────────────────────────────────────────────────────┤
│ Domain Layer                                                    │
│   - Entity / Value Object                                       │
│   - Domain Service: M3(사전점검), M4(개별산출), M5(최적조합)      │
│   - MX: 순환참조 해결, 법령버전 매칭, 107개 검증 규칙             │
├─────────────────────────────────────────────────────────────────┤
│ Infrastructure Layer                                            │
│   - JPA Entity (83개 테이블)                                     │
│   - MyBatis Mapper (복잡 쿼리)                                   │
│   - Spring Security (JWT, RBAC)                                 │
│   - PostgreSQL 15 + RF_* 기준정보 26개 테이블                    │
└─────────────────────────────────────────────────────────────────┘
```

### 4.4 핵심 설계 원칙 8가지

| 원칙 | 설명 |
|------|------|
| **Request-Driven** | 1회 진단 = 1 req_id = 1 트랜잭션 단위 |
| **원본 불변성** | RI_S_RAW_DATA INSERT ONLY, 수정 시 새 req_id |
| **요약 재생성** | SV_* = RI_S_RAW_DATA에서 언제든 재파싱 |
| **결과 이중 보관** | CO_* 정규 + CO_S_REPORT_JSON 직렬화 |
| **기준정보 독립** | RF_* = req_id 없이 연도별 독립 관리 |
| **세목 분기** | TAX_TYPE(CORP/INC)으로 모듈/테이블 자동 활성화 |
| **절사 원칙** | 금액 10원 미만 TRUNCATE, 비율 3자리, 반올림 금지 |
| **적용순서** | 감면→이월불가 공제→이월가능 공제 (**법인세법 §59** / **소득세법 §60**) |

### 4.5 모듈 구성 개요

```
M0 (TAX_TYPE 분기: CORP/INC)
  │
  ├── M1 (입력 관리, 20개 서브모듈)
  │     ├── M1-01~M1-12: 공통/법인 입력 검증
  │     └── P1-01~P1-08: 개인 전용 입력 검증
  │
  ├── M3-PREP (데이터 준비, 법령 버전 결정)
  │
  ├── M3 (사전 점검, 10개 서브모듈)
  │     ├── M3-00~M3-06: 공통 사전점검
  │     └── P3-01~P3-04: 개인 전용 사전점검
  │
  ├── M4 (개별 공제/감면, 22개 서브모듈)
  │     ├── M4-01~M4-06: 공통 6대 공제/감면
  │     ├── M4-07~M4-15, M4-42: 법인 전용
  │     └── P4-01~P4-12: 개인 전용
  │
  ├── M5 (최적 조합, 6개 서브모듈)
  │     ├── M5-01~M5-05: 상호배제, B&B, 최저한세, 농특세, 적용순서
  │     └── P5-01: 개인 최저한세
  │
  ├── M6 (최종 산출, 5개 서브모듈)
  │     └── M6-01~M6-05: 비교표, 가산금, 지방소득세, 보고서 3종, JSON
  │
  ├── M7 (시뮬레이션, Phase 2)
  │
  └── MX (횡단 기능)
        ├── MX-01: 순환참조 해결 (최대 5회 수렴)
        ├── MX-02: 법령 버전 자동 매칭 (2018~2025)
        └── MX-03: 검증 엔진 (107개 규칙)
```

### 4.6 데이터베이스 설계 방향

**83개 테이블 + 뷰 1개** (5개 주제영역)

| 주제영역 | 접두어 | CORP | INC | 공통 | 합계 | 역할 |
|---------|--------|:----:|:---:|:----:|:----:|------|
| 요청/입력 | RI_ | 17 | 8 | 12 | **37** | 원시 데이터 보관 |
| 요약/검증 | SV_ | - | - | 8 | **8** | 계산용 파생 데이터 |
| 산출 결과 | CO_ | - | 3 | 8 | **11** | 결과 이중 보관 |
| 감사 로그 | AL_ | - | - | 1 | **1** | APPEND ONLY 이력 |
| 기준 정보 | RF_ | 7 | 4 | 15 | **26** | 세율/규칙 독립 관리 |

**테이블 명명 규칙**: `{주제영역}_{세목구분(S/C/I)}_{테이블명}`
- 예: `RI_S_RAW_DATA`, `RF_C_INVESTMENT_CREDIT_RATE`, `CO_I_LOSS_CARRYBACK`

**입력 카테고리 32개**:
- 공통 8개: employee_detail, employee_monthly, investment, startup, sme_special, rd_expense, existing_deduction, foreign_tax
- CORP 전용 16개: corp_basic(필수), representative, loss_carryforward, credit_carryforward, branch_location, interim_tax, dividend_income 등
- INC 전용 8개: inc_basic(필수), inc_business, inc_other_income, inc_deduction, inc_sincerity, inc_foreign_tax, inc_rental_reduction, inc_joint_biz

### 4.7 세목별 핵심 차이점 (구현 분기 필수)

| 항목 | 법인세(CORP) | 종합소득세(INC) |
|------|------------|--------------|
| 최저한세 기준 | **과세표준** × 7~17% | **산출세액** × 35%/45% |
| 소재지 판단 | 본점 간주 (본점 수도권→전사업장) | 사업장별 **개별** 판단 |
| 적용순서 | **법인세법 §59** | **소득세법 §60** |
| 상시근로자 제외 | 임원, 최대주주 4촌혈족 | 대표자, 배우자, 직계존비속 |
| 소득 구조 | 각사업연도소득 단일 | 6종 소득 합산 |
| 감면소득 배분 | 직접 계산 | 산출세액×(감면소득÷종합소득)×감면율 |
| 환급가산금 | **익금불산입** (§18④) | 비과세 소득 |
| 경정청구 기산 | 다음해 3.31 | 다음해 5.31 (성실: 6.30) |

---

## 5. 구현 로드맵

### 5.1 Phase 1 — MVP (21개 스토리, 177 SP)

```
Sprint 1: 기반 구축 (38 SP)
├── US-027: RBAC 인증/권한 (JWT 4단계)         [8 SP]
├── US-023: 기준정보 관리 (RF_* 26개 테이블)     [8 SP]
├── US-001: 요청 생성 (req_id, Idempotency)     [5 SP]
├── US-002: 법인 세무자료 입력 (32개 카테고리)    [8 SP]
├── US-003: 개인사업자 세무자료 입력               [8 SP]
└── 기준정보 초기 데이터 시딩 (2018~2025 세율)     [+α]

Sprint 2: 사전점검 + 검증 (34 SP)
├── US-004: 입력 데이터 107개 규칙 검증           [13 SP]
├── US-005: 경정청구 불가사유 차단                  [8 SP]
├── US-006: 중소기업 해당 여부 판정                 [5 SP]
├── US-007: 소재지 구분 판단 (법인/개인 분기)        [8 SP]
└── [의존] Sprint 1 완료 필수

Sprint 3: 핵심 계산엔진 (42 SP)
├── US-008: 상시근로자 수 산정                     [8 SP]
├── US-009: 통합투자세액공제 §24                   [8 SP]
├── US-010: 통합고용세액공제 §29의8                [13 SP]
├── US-011: 창업중소기업 세액감면 §6                [8 SP]
├── US-012: 중소기업 특별세액감면 §7                [5 SP]
└── [의존] Sprint 2 완료 필수

Sprint 4: 최적조합 + 보고서 (37 SP)
├── US-013: R&D 세액공제 §10                      [8 SP]
├── US-017: 상호배제 10규칙 자동 적용               [8 SP]
├── US-018: 최적 조합 탐색 (B&B / Greedy)          [13 SP]
├── US-019: 최저한세 자동 적용                      [8 SP]
└── [의존] Sprint 3 완료 필수

Sprint 5: 보고서 + 통합 테스트 (26 SP)
├── US-020: 환급액 비교 보고서 8섹션                [8 SP]
├── US-021: 환급가산금 기본 계산 (본세/중간예납)      [5 SP]
├── US-022: 지방소득세 환급액 안내 (보고서 포함)      [3 SP]
├── 통합 테스트 (E2E 시나리오 10개)                  [5 SP]
├── 성능 테스트 (77개 항목 30초, 동시 100요청)       [5 SP]
└── [의존] Sprint 4 완료 필수
```

### 5.2 Phase 1 의존성 다이어그램

```
[US-027 인증/권한] ──────────────────────────────────────────┐
[US-023 기준정보] ───────────────────────────────────────────┤
                                                              ↓
[US-001 요청생성]
    ↓
[US-002 법인입력] ──→ [US-004 검증107규칙]
[US-003 개인입력] ─┘
                          ↓
              ┌───────────────────────────────┐
              [US-005 불가사유] [US-006 중소기업]
              [US-007 소재지]  [US-008 근로자]
              └───────────────────────────────┘
                          ↓
          ┌─────────────────────────────────────┐
          [US-009 투자§24]  [US-010 고용§29의8]
          [US-011 창업§6]   [US-012 중소특별§7]
          [US-013 R&D§10]
          └─────────────────────────────────────┘
                          ↓
                  [US-017 상호배제10규칙]
                          ↓
              [US-018 최적조합] → [US-019 최저한세]
                          ↓
                  [US-020 보고서생성]
```

### 5.3 Phase 2/3 로드맵 (요약)

| Phase | 기간(목표) | 핵심 내용 | 스토리 수 |
|:-----:|:--------:|----------|:---------:|
| Phase 2 | Phase 1 이후 | 법인/개인 전용 심화, 가산금, 대시보드, 시뮬레이션 | 13개 |
| Phase 3 | Phase 2 이후 | 홈택스 연동, B2C 확장 | 4개 |

---

## 6. 성공 기준

### 6.1 Definition of Done (Phase 1 MVP)

- [ ] 19개 기능 요구사항 전수 구현
- [ ] 56개 계산 공식 단위 테스트 **100%** 통과
- [ ] 107개 검증 규칙 통합 테스트 통과
- [ ] E2E 시나리오 10개 (법인 5개 + 개인 5개) 통과
- [ ] 77개 점검항목 전체 산출 **30초 이내**
- [ ] 동시 100 요청 처리 검증
- [ ] OpenAPI 3.0 문서 완성
- [ ] 코드 리뷰 완료

### 6.2 품질 기준

| 기준 | 목표 |
|------|------|
| 단위 테스트 커버리지 | 80% 이상 (공식 100%) |
| SonarQube Lint | 오류 0건, 기술부채 A등급 |
| 계산 정밀도 | 10원 미만 절사, 소수점 3자리 절사 100% 준수 |
| 세율 정확도 | 2018~2025 세율 테이블 원문 대조 100% |
| 보안 | OWASP Top 10 대응, 개인정보 AES-256 |

### 6.3 비즈니스 성과 기준

| 지표 | 목표 |
|------|------|
| 건당 진단 시간 | 3시간 → 30분 이내 (90% 단축) |
| 누락 공제 발굴률 | 수작업 대비 20% 이상 향상 |
| 최적 조합 정확도 | Branch & Bound 기준 정확도 99% 이상 |

---

## 7. 리스크 및 대응

### 7.1 기술적 리스크

| 리스크 | 영향 | 가능성 | 대응 방안 |
|--------|:----:|:-----:|-----------|
| 순환참조 수렴 실패 (과세표준↔최저한세) | 높음 | 중간 | 최대 5회 반복 + 실패 시 최선 결과 반환 + 경고 |
| B&B 성능 저하 (항목 과다) | 높음 | 낮음 | 15개 초과 시 Greedy 폴백, 임계치 파라미터화 |
| 기준정보 오입력 | 높음 | 중간 | 이전 연도 비교 미리보기, 감사 로그, 이중 확인 |
| 이월결손금 연쇄 무한루프 | 높음 | 낮음 | 최대 5회 제한, 발산 감지 시 오류 처리 |
| DDL 미확정 상태 구현 착수 | 중간 | 높음 | Design 단계에서 DDL 우선 확정 후 구현 |

### 7.2 세법/규제 리스크

| 리스크 | 영향 | 가능성 | 대응 방안 |
|--------|:----:|:-----:|-----------|
| 연간 세법 개정 (12월 말) | 높음 | 매우높음 | RF_* 분리 설계, 개정 후 2주 내 반영 |
| 창업+고용 중복배제 (2025년) | 높음 | 이미발생 | 과세연도별 규칙 분기 구현 |
| 사보공제 일몰 연장 가능성 | 중간 | 중간 | 적용기한 파라미터화 |
| 국세청 원클릭 확대 | 중간 | 높음 | B2B 전문가 기능으로 차별화 |

### 7.3 비즈니스 리스크

| 리스크 | 영향 | 가능성 | 대응 방안 |
|--------|:----:|:-----:|-----------|
| 계산 오류 → 가산세 | 매우높음 | 낮음 | 세무사 최종 검토 필수, 산출물 "초안" 표시 |
| 개인정보 유출 | 매우높음 | 낮음 | AES-256, RBAC, 감사 로그 |

---

## 8. 컨벤션 및 파이프라인

### 8.1 기존 프로젝트 컨벤션 상태

- [ ] `CLAUDE.md` 코딩 컨벤션 섹션 — 미존재 (생성 필요)
- [ ] 컨벤션 문서 — 미존재 (Design 단계에서 정의)
- [ ] Java 코딩 스타일 — Google Java Style + Checkstyle 적용 예정
- [ ] DB 명명 규칙 — 정의됨: `{주제영역}_{세목}_{테이블명}` (참고1번)

### 8.2 정의 필요 컨벤션

| 카테고리 | 현재 | 정의 필요 | 우선도 |
|---------|------|----------|:------:|
| **패키지 구조** | 미정의 | Clean Architecture 4계층 패키지 | 높음 |
| **명명 규칙** | DB만 정의 | Java 클래스/메서드/상수 명명 | 높음 |
| **에러 처리** | 미정의 | Hard Fail / Soft Fail 패턴 | 높음 |
| **로깅** | 미정의 | Logback 구조화 로그 (req_id 포함) | 중간 |
| **테스트** | 미정의 | 공식 단위 테스트 명명, 시나리오 구조 | 중간 |
| **환경 변수** | 미정의 | DB_URL, JWT_SECRET, RF_DATA_PATH 등 | 중간 |

### 8.3 환경 변수 (예정)

| 변수 | 용도 | 범위 |
|------|------|------|
| `SPRING_DATASOURCE_URL` | PostgreSQL 15 연결 | Server |
| `SPRING_DATASOURCE_USERNAME` | DB 사용자 | Server |
| `SPRING_DATASOURCE_PASSWORD` | DB 비밀번호 | Server |
| `JWT_SECRET_KEY` | JWT 서명 키 | Server |
| `JWT_EXPIRATION_MS` | JWT 유효시간 (8시간) | Server |
| `APP_CALCULATION_TIMEOUT_MS` | 계산 타임아웃 (30초) | Server |
| `APP_BB_MAX_ITEMS` | B&B 임계값 (기본 15) | Server |
| `APP_CONVERGENCE_MAX_ITER` | 순환참조 최대 반복 (기본 5) | Server |

### 8.4 파이프라인 연계

| Phase | 상태 | 문서 위치 | 다음 액션 |
|-------|:----:|----------|----------|
| Phase 1 (Schema) | ☐ | `docs/01-plan/schema.md` | Design 이후 진행 |
| Phase 2 (Convention) | ☐ | `docs/01-plan/conventions.md` | Design 이후 진행 |

---

## 9. 다음 단계

1. [ ] **Plan 리뷰 및 승인** — 이 계획서를 팀 리뷰
2. [ ] **Design 문서 작성** (`/pdca design Tax-refund`)
   - 참고1번 설계서(초안) 기반 확정판 작성
   - 83개 테이블 DDL 확정
   - API 스펙 OpenAPI 3.0 확정
   - 56개 공식 의사코드 검증
3. [ ] **Schema 정의** (`/phase-1-schema`)
   - 엔티티 스키마 확정, ERD 작성
4. [ ] **Convention 정의** (`/phase-2-convention`)
   - Java/Spring Boot 코딩 컨벤션 확립
5. [ ] **구현 착수** (`/pdca do Tax-refund`)
   - Sprint 1부터 순차 구현

---

## 버전 이력

| 버전 | 날짜 | 변경 내용 | 작성자 |
|------|------|-----------|--------|
| 1.0 | 2026-02-18 | 최초 작성 — 범위, 로드맵, 아키텍처 방향, 성공 기준, 리스크 정의 | Plan (PDCA) |
| 1.1 | 2026-02-18 | 보완 — (1)Sprint 5 SP 배정(26SP) (2)환급가산금/지방소득세 Phase 1 승격(FR-20,21) (3)개인전용 Phase 2 항목 10개 구체화 (4)경과규정 추가 (5)적용순서 법령 명시(§59/§60) (6)API 7→11개 반영 (7)총SP 150→177 조정 | Plan (PDCA) |
